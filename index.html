<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Token Information</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .token-info {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }
        .token-logo {
            width: 64px;
            height: 64px;
            border-radius: 50%;
        }
        .info-row {
            display: flex;
            margin-bottom: 10px;
        }
        .info-label {
            font-weight: bold;
            width: 150px;
        }
    </style>
</head>
<body>
    <h1>Solana Token Information</h1>
    
    <div class="token-info" id="tokenInfo">
        <p>Loading token information...</p>
    </div>

    <script>
        // Replace with your actual token mint address
        const tokenMintAddress = "YOUR_TOKEN_MINT_ADDRESS";
        
        // Replace with your Bitquery API token
        const apiToken = "YOUR_BITQUERY_API_TOKEN";
        
        async function fetchTokenInfo() {
            const query = `{
                Solana {
                    DEXTradeByTokens(
                        where: {
                            Trade: {
                                Currency: {
                                    MintAddress: {is: "${tokenMintAddress}"}
                                }
                            }, 
                            Transaction: {Result: {Success: true}}
                        }
                        orderBy: {descending: Block_Time}
                        limit: {count: 1}
                    ) {
                        Trade {
                            Currency {
                                Name
                                Symbol
                                MintAddress
                                Uri
                                UpdateAuthority
                                IsMutable
                            }
                        }
                    }
                    
                    TokenSupplyUpdates(
                        limit: {count: 1}
                        orderBy: {descending: Block_Time}
                        where: {
                            TokenSupplyUpdate: {
                                Currency: {
                                    MintAddress: {is: "${tokenMintAddress}"}
                                }
                            }
                        }
                    ) {
                        TokenSupplyUpdate {
                            Currency {
                                Name
                                Symbol
                                MintAddress
                                Decimals
                            }
                            supply: PostBalance
                        }
                    }
                    
                    Instructions(
                        where: {
                            Instruction: {
                                Program: {
                                    Address: {is: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"}, 
                                    Method: {is: "initializeMint"}
                                },
                                Accounts: {
                                    Address: {is: "${tokenMintAddress}"}
                                }
                            }
                        }
                        limit: {count: 1}
                    ) {
                        Instruction {
                            Accounts {
                                Address
                                IsWritable
                                Token {
                                    Mint
                                    Owner
                                    ProgramId
                                }
                            }
                        }
                    }
                }
            }`;

            try {
                const response = await fetch('https://graphql.bitquery.io', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiToken}`
                    },
                    body: JSON.stringify({ query })
                });

                const data = await response.json();
                displayTokenInfo(data);
                
                // If the token has a URI, fetch additional metadata
                const tokenUri = data?.data?.Solana?.DEXTradeByTokens?.[0]?.Trade?.Currency?.Uri;
                if (tokenUri) {
                    fetchTokenMetadata(tokenUri);
                }
            } catch (error) {
                console.error('Error fetching token info:', error);
                document.getElementById('tokenInfo').innerHTML = `<p>Error loading token information: ${error.message}</p>`;
            }
        }
        
        async function fetchTokenMetadata(uri) {
            try {
                const response = await fetch(uri);
                const metadata = await response.json();
                
                // Update UI with logo and social links if available
                if (metadata.image) {
                    document.getElementById('tokenLogo').src = metadata.image;
                }
                
                let socialLinksHtml = '';
                if (metadata.external_url) {
                    socialLinksHtml += `<a href="${metadata.external_url}" target="_blank">Website</a> `;
                }
                if (metadata.twitter_url) {
                    socialLinksHtml += `<a href="${metadata.twitter_url}" target="_blank">Twitter</a> `;
                }
                if (metadata.telegram_url) {
                    socialLinksHtml += `<a href="${metadata.telegram_url}" target="_blank">Telegram</a> `;
                }
                
                if (socialLinksHtml) {
                    document.getElementById('socialLinks').innerHTML = socialLinksHtml;
                }
            } catch (error) {
                console.error('Error fetching token metadata:', error);
            }
        }
        
        function displayTokenInfo(data) {
            const tokenData = data?.data?.Solana;
            
            if (!tokenData) {
                document.getElementById('tokenInfo').innerHTML = '<p>No token information found</p>';
                return;
            }
            
            const tokenDetails = tokenData.DEXTradeByTokens?.[0]?.Trade?.Currency || {};
            const supplyInfo = tokenData.TokenSupplyUpdates?.[0]?.TokenSupplyUpdate || {};
            const authorities = tokenData.Instructions?.[0]?.Instruction?.Accounts || [];
            
            // Find mint and freeze authorities
            let mintAuthority = 'Not available';
            let freezeAuthority = 'Not available';
            
            // This is a simplified approach - actual authority determination may be more complex
            if (authorities.length > 0) {
                mintAuthority = authorities[1]?.Address || 'Not available';
                freezeAuthority = authorities[2]?.Address || 'None';
            }
            
            let html = `
                <div class="info-row">
                    <div class="info-label">Token Logo:</div>
                    <div><img id="tokenLogo" class="token-logo" src="https://via.placeholder.com/64" alt="Token Logo"></div>
                </div>
                <div class="info-row">
                    <div class="info-label">Token Name:</div>
                    <div>${tokenDetails.Name || 'Not available'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Token Symbol:</div>
                    <div>${tokenDetails.Symbol || 'Not available'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Token Address:</div>
                    <div>${tokenDetails.MintAddress || 'Not available'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Supply:</div>
                    <div>${formatSupply(supplyInfo.supply, supplyInfo.Currency?.Decimals)}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Mint Authority:</div>
                    <div>${mintAuthority}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Freeze Authority:</div>
                    <div>${freezeAuthority}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Social Links:</div>
                    <div id="socialLinks">Loading...</div>
                </div>
            `;
            
            document.getElementById('tokenInfo').innerHTML = html;
        }
        
        function formatSupply(supply, decimals) {
            if (!supply) return 'Not available';
            
            try {
                const decimalPlaces = parseInt(decimals) || 0;
                const formattedSupply = (parseInt(supply) / Math.pow(10, decimalPlaces)).toLocaleString();
                return formattedSupply;
            } catch (e) {
                return supply;
            }
        }
        
        // Fetch token info when page loads
        fetchTokenInfo();
    </script>
</body>
</html>
